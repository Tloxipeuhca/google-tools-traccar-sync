# =============================================================================
# GoogleFindMyTools – Traccar sync service
#
# Prerequisites:
#   1. Generate Auth/secrets.json first (see README.md, step 2)
#   2. Copy .env.example to .env (in this directory) and fill in the values
#
# Usage (run from the Traccar/ directory):
#   docker compose up -d            # build image and start in background
#   docker compose logs -f          # stream logs
#   docker compose down             # stop
# =============================================================================

services:
  traccar-sync:
    build: .                        # Dockerfile clones both repos automatically
    container_name: traccar-sync
    ports:
      - "${PORT:-5002}:${PORT:-5002}"
    env_file:
      - .env                          # loads all variables (SMTP, API_TOKEN, …)
    environment:
      # Defaults applied only when the variable is absent from .env
      TRACCAR_SERVER_URL: "${TRACCAR_SERVER_URL:-http://traccar:8082}"
      PORT: "${PORT:-5002}"
      AUTO_REGISTER_SERVICES: "${AUTO_REGISTER_SERVICES:-true}"
      AUTO_REGISTER_TIMER: "${AUTO_REGISTER_TIMER:-600}"
      AUTO_REGISTER_DELTA: "${AUTO_REGISTER_DELTA:-5}"
    volumes:
      # Google Find My credentials – generated once with: docker compose run traccar-sync python main.py
      # Mount only the credentials file (not the whole Auth/ dir) to keep Auth Python code intact
      - ./data/secrets.json:/app/Auth/secrets.json
      # Persistent runtime data (services.json, devices.json, locations.json)
      - ./data:/app/Data
      # Log files
      - ./logs:/app/logs
    restart: unless-stopped
